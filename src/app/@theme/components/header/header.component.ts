import { Component, OnDestroy, OnInit } from '@angular/core';
import { NbMediaBreakpointsService, NbMenuService, NbSidebarService, NbThemeService } from '@nebular/theme';

import { UserData } from '../../../@core/data/users';
import { LayoutService } from '../../../@core/utils';
import { filter, map, takeUntil } from 'rxjs/operators';
import { Subject } from 'rxjs';
import { NbAuthJWTToken, NbAuthService, NbTokenService } from '@nebular/auth';
import { Router } from '@angular/router';

@Component({
  selector: 'ngx-header',
  styleUrls: ['./header.component.scss'],
  templateUrl: './header.component.html',
})
export class HeaderComponent implements OnInit, OnDestroy {

  private destroy$: Subject<void> = new Subject<void>();
  userPictureOnly: boolean = false;
  user: any;
  base64image = "data:image/jpeg;base64,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"
 
  themes = [
    {
      value: 'default',
      name: 'Light',
    },
    {
      value: 'dark',
      name: 'Dark',
    },
    {
      value: 'cosmic',
      name: 'Cosmic',
    },
    {
      value: 'corporate',
      name: 'Corporate',
    },
  ];

  currentTheme = 'default';

  userMenu = [ { title: 'Sair' } ];

  constructor(
    private router: Router,
    private nbTokenService: NbTokenService,
    private authService: NbAuthService,
    private nbMenuService: NbMenuService,
    private sidebarService: NbSidebarService,
    private menuService: NbMenuService,
    private themeService: NbThemeService,
    private userService: UserData,
    private layoutService: LayoutService,
    private breakpointService: NbMediaBreakpointsService) {
  }

  ngOnInit() {
    this.currentTheme = this.themeService.currentTheme;

    this.userService.getUsers()
      .pipe(takeUntil(this.destroy$))
      .subscribe((users: any) => this.user = users.nick);

    const { xl } = this.breakpointService.getBreakpointsMap();
    this.themeService.onMediaQueryChange()
      .pipe(
        map(([, currentBreakpoint]) => currentBreakpoint.width < xl),
        takeUntil(this.destroy$),
      )
      .subscribe((isLessThanXl: boolean) => this.userPictureOnly = isLessThanXl);

    this.themeService.onThemeChange()
      .pipe(
        map(({ name }) => name),
        takeUntil(this.destroy$),
      )
      .subscribe(themeName => this.currentTheme = themeName);

    this.nbMenuService.onItemClick()
        .pipe(
          filter(({ tag }) => tag === 'login'),
          map(({ item: { title } }) => title),
        )
        .subscribe(title => {
          if(title === 'Sair'){
            this.nbTokenService.clear()
            this.router.navigate(['/auth']);
          }
      });

    this.authService.onTokenChange()
      .subscribe((token: NbAuthJWTToken) => {
      
        if (token.isValid()) {
          const payload = token.getPayload();
          this.user = payload; 
        }
        
    });
  }

  ngOnDestroy() {
    this.destroy$.next();
    this.destroy$.complete();
  }

  changeTheme(themeName: string) {
    this.themeService.changeTheme(themeName);
  }

  toggleSidebar(): boolean {
    this.sidebarService.toggle(true, 'menu-sidebar');
    this.layoutService.changeLayoutSize();

    return false;
  }

  navigateHome() {
    this.menuService.navigateHome();
    return false;
  }
}
